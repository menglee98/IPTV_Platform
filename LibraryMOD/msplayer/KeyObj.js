//----- Key Control Function -----		
//Key Object	
function KeyDSL4000()
{
	this.RED	= 2147483793;		//1073741956 - IP420// 2147483793 - DSL4000
	this.GREEN	= 2147483794;	  //1073741957 - IP420// 2147483794 - DSL4000
	this.YELLOW	= 2147483795;	//1073741958 - IP420// 2147483795 - DSL4000
	this.BLUE	= 2147483796;	  //1073741959 - IP420// 2147483796 - DSL4000

	this.PLAY	= 2147483785;		//1073742080 - IP420// 2147483785 - DSL4000
	this.STOP	= 2147483851;		//1073742082 - IP420// 2147483851 - DSL4000

	this.PAUSE	= 2147483782;
	this.REW	= 2147483784;
	this.FF		= 2147483850;
	this.STEP_RW	= 2147483781;
	this.STEP_FF	= 2147483783;

	this.LINE_MINUS	= 2147483787;
	this.LINE_PLUS	= 30;
	this.PAGE_MINUS	= 2147483806;
	this.PAGE_PLUS	= 2147483807;

	this.ARROW_LEFT	= 2147483788; 		//1073741840 - IP420// 2147483788 - DSL4000
	this.ARROW_RIGHT= 2147483789; 	  //1073741841 - IP420// 2147483789 - DSL4000
	this.ARROW_DOWN	= 2147483790; 	 //1073741839 - IP420// 2147483790 - DSL4000
	this.ARROW_UP	= 2147483791; 		//1073741838 - IP420// 2147483791 - DSL4000
	
	this.HELP 	= 2147483777;	 //1073741964 - IP420// 2147483777 - DSL4000
	this.INFO	= 2147483778;    //1073741961 - IP420// 2147483778 - DSL4000
	this.BACK 	= 8;	//1073741952 - IP420// 8 - DSL4000
	this.SELECT 	= 13;	  //1073741828 - IP420// 13 - DSL4000
	this.KEY_HOME	= 2147483779;	//1073741955 - IP420// 2147483779 - DSL4000

	this.NUMBER_0	= 48;	//1610612744 - IP420// 48 - DSL4000
	this.NUMBER_1	= 49;	//1610612745 - IP420// 49 - DSL4000
	this.NUMBER_2	= 50;	//1610612746 - IP420// 50 - DSL4000
	this.NUMBER_3	= 51;	//1610612747 - IP420// 51 - DSL4000
	this.NUMBER_4	= 52;	//1610612748 - IP420// 52 - DSL4000
	this.NUMBER_5	= 53;	//1610612749 - IP420// 53 - DSL4000
	this.NUMBER_6	= 54;	//1610612750 - IP420// 54 - DSL4000
	this.NUMBER_7	= 55;	//1610612751 - IP420// 55 - DSL4000
	this.NUMBER_8	= 56;	//1610612752 - IP420// 56 - DSL4000
	this.NUMBER_9	= 57;	//1610612753 - IP420// 57 - DSL4000
}

function KeyIP420()
{
	this.RED	= 1073741956;		//1073741956 - IP420// 2147483793 - DSL4000
	this.GREEN	= 1073741957;		//1073741957 - IP420// 2147483794 - DSL4000
	this.YELLOW	= 1073741958;		//1073741958 - IP420// 2147483795 - DSL4000
	this.BLUE	= 1073741959;		//1073741959 - IP420// 2147483796 - DSL4000

	this.PLAY	= 1073742080;		//1073742080 - IP420// 2147483785 - DSL4000
	this.STOP	= 1073742082;		//1073742082 - IP420// 2147483851 - DSL4000

	this.PAUSE	= 1073742081;		//1073742081 - IP420// 2147483782 - DSL4000
	this.REW	= 1073742085;		//1073742085 - IP420// 2147483784 - DSL4000
	this.FF		= 1073742084;		//1073742084 - IP420// 2147483850 - DSL4000
	this.STEP_RW	= 1073741827;	//1073741827 - IP420// 2147483781 - DSL4000
	this.STEP_FF	= 1073742083;	//1073742083 - IP420// 2147483783 - DSL4000

	this.LINE_MINUS	= 2147483787;
	this.LINE_PLUS	= 30;
	this.PAGE_MINUS	= 2147483806;
	this.PAGE_PLUS	= 2147483807;

	this.ARROW_LEFT	= 1073741840;	//1073741840 - IP420// 2147483788 - DSL4000
	this.ARROW_RIGHT= 1073741841;	//1073741841 - IP420// 2147483789 - DSL4000
	this.ARROW_DOWN	= 1073741839;	//1073741839 - IP420// 2147483790 - DSL4000
	this.ARROW_UP	= 1073741838;	//1073741838 - IP420// 2147483791 - DSL4000
	
	this.HELP 	= 1073741964;		//1073741964 - IP420// 2147483777 - DSL4000
	this.INFO	= 1073741961		//1073741961 - IP420// 2147483778 - DSL4000
	this.BACK 	= 1073741953;		//1073741953 - IP420// 8 - DSL4000
	this.SELECT 	= 1073741828;	//1073741828 - IP420// 13 - DSL4000
	this.KEY_HOME	= 1073741955;	//1073741955 - IP420// 2147483779 - DSL4000

	this.NUMBER_0	= 1610612744;	//1610612744 - IP420// 48 - DSL4000
	this.NUMBER_1	= 1610612745;	//1610612745 - IP420// 49 - DSL4000
	this.NUMBER_2	= 1610612746;	//1610612746 - IP420// 50 - DSL4000
	this.NUMBER_3	= 1610612747;	//1610612747 - IP420// 51 - DSL4000
	this.NUMBER_4	= 1610612748;	//1610612748 - IP420// 52 - DSL4000
	this.NUMBER_5	= 1610612749;	//1610612749 - IP420// 53 - DSL4000
	this.NUMBER_6	= 1610612750;	//1610612750 - IP420// 54 - DSL4000
	this.NUMBER_7	= 1610612751;	//1610612751 - IP420// 55 - DSL4000
	this.NUMBER_8	= 1610612752;	//1610612752 - IP420// 56 - DSL4000
	this.NUMBER_9	= 1610612753;	//1610612753 - IP420// 57 - DSL4000
	//選擇 1828107374
}

function KeyCT7010()
{	// 特殊功能鍵
	this.RED	= 113;	// q
	this.GREEN	= 119;	// w
	this.YELLOW	= 101;	// e
	this.BLUE	= 114;	// r
	
	this.INFO	= 9 ;	// i
	this.KEY_HOME	= 129 ;	// h
	this.PAUSE	= 134 ;	// p
	this.STOP	= 132 ;	// S
	
	this.BACK 	= 18;	// b
	this.SELECT	= 13;	// Enter
	
	this.NUMBER_0	= 96;	
	this.NUMBER_1	= 97;	
	this.NUMBER_2	= 98;	
	this.NUMBER_3	= 99;	
	this.NUMBER_4	= 100;	
	this.NUMBER_5	= 101;	
	this.NUMBER_6	= 102;	
	this.NUMBER_7	= 103;	
	this.NUMBER_8	= 104;	
	this.NUMBER_9	= 105;	
	this.ARROW_UP 	= 38;		
	this.ARROW_DOWN	= 40;		
	this.ARROW_LEFT	= 37;		
	this.ARROW_RIGHT = 39;		
}

function KeyComputer()
{
	this.RED	= 113;	// q
	this.GREEN	= 119;	// w
	this.YELLOW	= 101;	// e
	this.BLUE	= 114;	// r
	
	this.INFO	= 105 ;	// i
	this.KEY_HOME	= 104 ;	// h
	this.PAUSE	= 112 ;	// p
	this.STOP	= 83 ;	// S
	
	this.BACK 	= 98;	// b
	this.SELECT	= 13;	// Enter
	
	this.NUMBER_0	= 48;	//1610612744 - IP420// 48 - DSL4000
	this.NUMBER_1	= 49;	//1610612745 - IP420// 49 - DSL4000
	this.NUMBER_2	= 50;	//1610612746 - IP420// 50 - DSL4000
	this.NUMBER_3	= 51;	//1610612747 - IP420// 51 - DSL4000
	this.NUMBER_4	= 52;	//1610612748 - IP420// 52 - DSL4000
	this.NUMBER_5	= 53;	//1610612749 - IP420// 53 - DSL4000
	this.NUMBER_6	= 54;	//1610612750 - IP420// 54 - DSL4000
	this.NUMBER_7	= 55;	//1610612751 - IP420// 55 - DSL4000
	this.NUMBER_8	= 56;	//1610612752 - IP420// 56 - DSL4000
	this.NUMBER_9	= 57;	//1610612753 - IP420// 57 - DSL4000
	this.ARROW_UP 	= 115;		// s
	this.ARROW_DOWN	= 120;		// x
	this.ARROW_LEFT	= 122;		// z
	this.ARROW_RIGHT = 99;		// c
}

function KeyMOD2()
{	// 特殊功能鍵
	this.RED				= 99;						// c
	this.GREEN			= 100;					// d
	this.YELLOW			= 103;					// g
	this.BLUE				= 106;					// j
	this.ORANGE 		= 110;					// n
	this.PURPLE 		= 101;					// e
	// 輔助功能
	this.HELP 			= 104;					// ENTER (說明)
	this.MEMU				= 109;					// MENU (選單)
	this.INFO				= 121;					// INFO (資訊)
	this.SELECT 		= 1073741828;		// SELECT (選擇)
	this.POWER			= 268435568;		// POWER (電源)
	// 影像控制
	this.PLAY				= 114;					// r
	this.STOP				= 116;					// t
	this.PAUSE			= 112;					// p
	this.REW				= 98;						// b
	this.FF				= 102;					// f
	this.BOOKMARK		= 111;					// BOOKMARK (書籤)
	this.ZOOM			= 122;					// ZOOM (功能)
	this.ERASE			= 1073741833;		// 刪除
	// 頁面控制
	this.KEY_HOME		= 8;						// HOME (首頁)
	this.PAGE_BACK	= 1342177296;		// PREV.PAGE (回前頁)
	this.PAGE_MINUS	= 1073741836;		// 頁－
	this.PAGE_PLUS	= 1073741837;		// 頁＋
	// 音量控制
	this.MUTE				= 115;					// MUTE (靜音)
	this.VOL_MINUS	= 1073741849;		// 音量－
	this.VOL_PLUS		= 1073741850;		// 音量＋
	// 方向控制
	this.ARROW_LEFT	= 1073741840;		// 左
	this.ARROW_RIGHT= 1073741841;		// 右
	this.ARROW_DOWN	= 1073741839;		// 下
	this.ARROW_UP		= 1073741838;		// 上
	// 鍵盤輸入
	this.KEYBOARD		= 9;						// KEYBOARD (鍵盤)
	this.LANGUAGE		= 97;						// LANGUAGE (語言)
	this.CAPE				= 119;					// CAPE (大小寫)
	this.BACK 			= 1342177296;		// BACK (倒退)
	// 數字鍵
	this.NUMBER_0		= 48;						// 數字鍵 0
	this.NUMBER_1		= 49;						// 數字鍵 1
	this.NUMBER_2		= 50;						// 數字鍵 2
	this.NUMBER_3		= 51;						// 數字鍵 3
	this.NUMBER_4		= 52;						// 數字鍵 4
	this.NUMBER_5		= 53;						// 數字鍵 5
	this.NUMBER_6		= 54;						// 數字鍵 6
	this.NUMBER_7		= 55;						// 數字鍵 7
	this.NUMBER_8		= 56;						// 數字鍵 8
	this.NUMBER_9		= 57;						// 數字鍵 9
}


function KeyMOD202()
{	// 特殊功能鍵
	this.RED			= 1082;						// c
	this.GREEN		= 1071;					// d
	this.YELLOW		= 1089;					// g
	this.BLUE			= 1066;					// j
	this.ORANGE 	= 1079;					// n
	this.PURPLE 		= 1080;					// e
	// 輔助功能
	this.HELP 			= 90;					// ENTER (說明)
	this.MEMU		= 90;					// MENU (選單)
	this.INFO			= 82;					// INFO (資訊)
	this.SELECT 		= 13;		// SELECT (選擇)
	//this.POWER		= 0x0521;		// POWER (電源)
	// 影像控制
	this.PLAY			= 86;					// r
	this.STOP			= 81;					// t
	this.PAUSE		= 79;					// p
	this.REW			= 66;						// b
	this.FF			= 70;					// f
	this.BOOKMARK	= 70;					// BOOKMARK (書籤)
	this.ZOOM		= 85;					// ZOOM (功能)
	this.ERASE		= 8;		// 刪除
	// 頁面控制
	this.KEY_HOME		= 72;						// HOME (首頁)
	this.PAGE_BACK	= 80;		// PREV.PAGE (回前頁)
	this.PAGE_MINUS	= 34;		// 頁－
	this.PAGE_PLUS	= 33;		// 頁＋
	// 音量控制
	this.MUTE			= 77;					// MUTE (靜音)
	this.VOL_MINUS	= 109;		// 音量－
	this.VOL_PLUS		= 107;		// 音量＋
	// 方向控制
	this.ARROW_LEFT	= 37;		// 左
	this.ARROW_RIGHT	= 39;		// 右
	this.ARROW_DOWN	= 40;		// 下
	this.ARROW_UP	= 38;		// 上
	// 鍵盤輸入
	this.KEYBOARD		= 73;						// KEYBOARD (鍵盤)
	this.LANGUAGE		= 89;					// LANGUAGE (語言)
	//this.CAPE			= 119;					// CAPE (大小寫)
	this.BACK 		= 80;					// BACK (倒退)
	// 數字鍵
	this.NUMBER_0		= 48;						// 數字鍵 0
	this.NUMBER_1		= 49;						// 數字鍵 1
	this.NUMBER_2		= 50;						// 數字鍵 2
	this.NUMBER_3		= 51;						// 數字鍵 3
	this.NUMBER_4		= 52;						// 數字鍵 4
	this.NUMBER_5		= 53;						// 數字鍵 5
	this.NUMBER_6		= 54;						// 數字鍵 6
	this.NUMBER_7		= 55;						// 數字鍵 7
	this.NUMBER_8		= 56;						// 數字鍵 8
	this.NUMBER_9		= 57;						// 數字鍵 9
}

function KeyMSD580()
{	
	// 輔助功能
	this.SUBTITLE	=67;
	this.SOUND	=68;	

	this.DISPLAY	=89;
	this.REPEAT	=84;
	this.SEARCH	=71;
	this.CHRTN	=78;

	// 數字鍵
	this.NUMBER_0		= 48;						// 數字鍵 0
	this.NUMBER_1		= 49;						// 數字鍵 1
	this.NUMBER_2		= 50;						// 數字鍵 2
	this.NUMBER_3		= 51;						// 數字鍵 3
	this.NUMBER_4		= 52;						// 數字鍵 4
	this.NUMBER_5		= 53;						// 數字鍵 5
	this.NUMBER_6		= 54;						// 數字鍵 6
	this.NUMBER_7		= 55;						// 數字鍵 7
	this.NUMBER_8		= 56;						// 數字鍵 8
	this.NUMBER_9		= 57;						// 數字鍵 9
	
	// 頁面控制
	this.KEY_HOME	= 72;	// HOME (首頁)
	this.PAGE_BACK	= 80;		// PREV.PAGE (回前頁)	
	this.PAGE_NEXT	= 88;		// 下一頁


	this.ARROW_LEFT	= 66;		// 左	
	this.ARROW_RIGHT= 70;		// 右
	this.ARROW_UP	= 1009;		// 上
	this.ARROW_DOWN	= 9;		// 下
	

	// 影像控制
	this.PLAY	= 13;
	this.STOP	= 81;
	this.PAUSE	= 79;
	this.REW	= 66;
	this.FF		= 70;

	// 音量控制
	this.MUTE	= 77;	
	this.VOL_MINUS	= 109;		// 音量－
	this.VOL_PLUS	= 107;		// 音量＋

	this.CH_PLUS	= 1009; //Shift + 9 (if Shiftkey==true?keycode + 1000)
	this.CH_MINUS	= 9;
	
	this.CLEAR	= 8;
	
	this.ZOOM	= 85;		// ZOOM (功能)
	this.SETUP	= 83;
	this.SLOW	= 76;
	this.WWW	= 87;
	this.EMail	= 69;
	this.FAVORITE	= 65;
	this.HELP	= 90;
	this.RELOAD	= 82;
	
	//以下配合原 MOD202 而加
	this.RED 	= 89;	
	this.GREEN	= 84;	
	this.YELLOW	= 71;	
	this.BLUE	= 78;

	this.BACK 	= 80;
	this.ERASE 	= 8;
	this.SELECT 	= 13;
	this.MEMU	= 90;
	this.INFO	= 82;
	this.BOOKMARK	= 70;
	this.PAGE_PLUS	= 88;
	this.PAGE_MINUS	= 80;		
}

function BrowserType()
{
	var tempKey;
	
	if(navigator.userAgent.indexOf("Mozilla/3.04")!=-1){
		tempKey=1
		return('DSL4000');
	}
	else if(navigator.userAgent.indexOf("Mozilla/4.77 (compatible; V2Browser/5.24 (1.121.2.5); ANTFresco/4.6.29.10; RISC OS-STB 4.0.0 STB4001910)")!=-1){
		tempKey=2
		return('DSL4000');
	}
	else if(navigator.userAgent.indexOf("Mozilla/4.77 (compatible; NCBrowser/5.76")!=-1){
		tempKey=3
		return('IP420');
	}
	else if(navigator.userAgent.indexOf(
			"Mozilla/4.77 (compatible; NCBrowser/5.77.1; ANTFresco/4.7.22.9; Linux/2.4.19-mips)")!=-1){
		tempKey=4
		return('IP420');
	}
	else if(navigator.userAgent.indexOf(
			"Mozilla/4.77 (compatible; NCBrowser/4; ANTFresco/4.10.03.devel; Linux/2.4.19-mips)")!=-1){
		tempKey=5
		return('IP420');
	}
	else if(navigator.userAgent.indexOf(
			"Mozilla/4.77 (compatible; NCBrowser/4; ANTFresco/4.10.04.03; Linux/2.4.19-mips)")!=-1){
		tempKey=6
		return('IP420');
	}
	else if((navigator.appName.indexOf("ANT Fresco") !=-1) && (navigator.appVersion.indexOf("4.08"))!=-1){
		tempKey = 7
		return('MOD2');
	}
	else if(navigator.userAgent.indexOf("Mozilla/4.0 (compatible; MSIE 6.0; Windows CE)")!=-1){
		tempKey=6
		//alert("MSIE");
		return('CT7010');
	}
	else if( navigator.appName.indexOf("Microsoft Internet Explorer") !=-1 ) {
		tempKey = 8
		return('MSIE');
	}
	else if((navigator.appName.indexOf("Netscape") !=-1) && (navigator.appVersion.indexOf("X11")!=-1)&& (navigator.userAgent.indexOf("SETABOXv1")!=-1)){
		tempKey = 9
		return('MOD202');
		//return('navigator.appName= ' + navigator.appName + ' navigator.appVersion= ' + navigator.appVersion);
	}
	else if((navigator.appName.indexOf("Netscape") !=-1) && (navigator.appVersion.indexOf("X11")!=-1)&& (navigator.userAgent.indexOf("Mozilla/5")!=-1)){
		tempKey = 10
		return('MSD580');
	//return('navigator.appName= ' + navigator.appName + ' navigator.appVersion= ' + navigator.appVersion);
	}
	else if( navigator.appName.indexOf("Netscape") !=-1 ) {
		tempKey = 11
		return('GOOGLE');
	}
	else{
		tempKey=0
		return('Other');
	}
}

var STBVersion = BrowserType();
var SetKeyStr = "document.onkeypress = function(){ return KEY_HANDLER(event) }" ;
var LockKeyStr = "document.onkeypress = function(){ return false };" ;
var FreeKeyStr = "document.onkeypress = function(){ return true };" ;
//var KeyHandlerStr = 'var key = top.key; var KCode = e.which ; if(window.navigator.platform == "Win32" || top.STBVersion == "MOD202") { KCode = e.keyCode; if(e.altKey   == true && KCode != 18)  KCode += 1000 ; } else if ( top.STBVersion == "MSD580" ){ KCode = e.keyCode; if(e.shiftKey   == true && KCode != 18)  KCode += 1000 ; }';
var KeyHandlerStr = 'var key = top.key; var ie4 = (document.all) ? true : false; var KCode = null; if (ie4) KCode = event.keyCode; else KCode = e.which ; if(window.navigator.platform == "Win32" || top.STBVersion == "MOD202") { KCode = event.keyCode; if(event.altKey   == true && KCode != 18)  KCode += 1000 ; } else if ( top.STBVersion == "MSD580" ){ KCode = event.keyCode; if(event.shiftKey   == true && KCode != 18)  KCode += 1000 ; }';
var PreloadStr = 'var arImages=new Array(); function Preload() { var temp = Preload.arguments; for(x=0; x < temp.length; x++) { arImages[x]=new Image(); arImages[x].src=Preload.arguments[x]; } } ';
//	KeyHandlerStr.replace("top.key", relation+"top.key"); //-->opener.top.key
function GetKeyHandlerStr( relation )
{
	var result = this.KeyHandlerStr.replace("top", relation) ;
	result = result.replace("top", relation) ;
	result = result.replace("top", relation) ;
	return result;
}

//建立按鍵
var key;
switch(STBVersion)
{
	case 'DSL4000':
		key = new KeyDSL4000();
		break;
	case 'IP420':
		key = new KeyIP420();
		break;
	case 'MOD2':
		key = new KeyMOD2();
		break;	
	
	case 'CT7010':
		key = new KeyCT7010();
		SetKeyStr = "document.onkeydown = KEY_HANDLER;" ;
		FreeKeyStr = "top.MediaFrame.FreeKey();";
		//alert("STBVersion: CT7010");
		break;	
		
	case 'MSIE':
		key = new KeyComputer();
		SetKeyStr = "document.onkeydown = KEY_HANDLER;" ;
		FreeKeyStr = "top.MediaFrame.FreeKey();";
		break;
		
	case 'MOD202':
		key = new KeyMOD202();		
		SetKeyStr = "document.onkeydown = KEY_HANDLER;" ;
		LockKeyStr = "document.onkeydown= function(){ return false }; jsvideo.set_focus_mode(false); " ;
		FreeKeyStr = "top.MediaFrame.FreeKey();";
		break;
	case 'MSD580':
		key = new KeyMSD580();
		SetKeyStr = "document.onkeydown = KEY_HANDLER;" ;
		LockKeyStr = "document.onkeydown= function(){ return false }; jsvideo.set_focus_mode(false); " ;
		FreeKeyStr = "top.MediaFrame.FreeKey();";
		break;	
	default:
		key = new KeyComputer();
		break;
}
